<?xml version="1.0" encoding="UTF-8"?>
<server:Capo xmlns:client="http://www.delcyon.com/capo-client"
    xmlns:resource="http://www.delcyon.com/capo/resource"
    xmlns:server="http://www.delcyon.com/capo-server"
    mainGroup="default"
    name="main">
    <ControllerRequest type="identity">
        <var name="TERM" value="dumb"/>
        <var name="IMSETTINGS_MODULE" value="none"/>
        <var name="KDEDIRS" value="/usr"/>
        <var name="SESSION_MANAGER"
            value="local/unix:@/tmp/.ICE-unix/2146,unix/unix:/tmp/.ICE-unix/2146"/>
        <var name="GNOME_DESKTOP_SESSION_ID" value="this-is-deprecated"/>
        <var name="IMSETTINGS_INTEGRATE_DESKTOP" value="yes"/>
        <var name="MOZ_PLUGIN_PATH" value="~/.plugins"/>
        <var name="MAIL" value="/var/spool/mail/jeremiah"/>
        <var name="GDMSESSION" value="gnome"/>
        <var name="XDG_SESSION_COOKIE"
            value="089b9fa58eec2d04692335cc00000082-1341332600.539045-854276670"/>
        <var name="PWD" value="/home/jeremiah"/>
        <var name="HOSTNAME" value="bluejay.goodinassociates.com"/>
        <var name="CVS_RSH" value="ssh"/>
        <var name="G_BROKEN_FILENAMES" value="1"/>
        <var name="NLSPATH" value="/usr/dt/lib/nls/msg/%L/%N.cat"/>
        <var name="GNOME_KEYRING_SOCKET" value="/tmp/keyring-J6ojtH/socket"/>
        <var name="CVSROOT" value=":pserver:jeremiah@penguin:/cvs"/>
        <var name="GDM_KEYBOARD_LAYOUT" value="us"/>
        <var name="HISTSIZE" value="1000"/>
        <var name="PATH"
            value="/usr/lib64/qt-3.3/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/jeremiah/bin"/>
        <var name="QTLIB" value="/usr/lib64/qt-3.3/lib"/>
        <var name="KDE_IS_PRELINKED" value="1"/>
        <var name="XAUTHORITY" value="/var/run/gdm/auth-for-jeremiah-ct04jt/database"/>
        <var name="GDM_LANG" value="en_US.utf8"/>
        <var name="WINDOWPATH" value="1"/>
        <var name="SSH_ASKPASS" value="/usr/libexec/openssh/gnome-ssh-askpass"/>
        <var name="SHLVL" value="1"/>
        <var name="MOZILLA_FIVE_HOME" value="/usr/lib/mozilla-1.7.6"/>
        <var name="XFILESEARCHPATH" value="/usr/dt/app-defaults/%L/Dt"/>
        <var name="QT_IM_MODULE" value="xim"/>
        <var name="LOGNAME" value="jeremiah"/>
        <var name="_" value="/usr/bin/gnome-session"/>
        <var name="XMODIFIERS" value="@im=none"/>
        <var name="QTDIR" value="/usr/lib64/qt-3.3"/>
        <var name="SSH_AUTH_SOCK" value="/tmp/keyring-J6ojtH/socket.ssh"/>
        <var name="LD_LIBRARY_PATH"
            value="/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/amd64/server:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/amd64:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/../lib/amd64:/usr/lib/mozilla-1.7.6"/>
        <var name="DBUS_SESSION_BUS_ADDRESS"
            value="unix:abstract=/tmp/dbus-IyLf4yf3zp,guid=1e9332a629a97f0e70e53e510000001d"/>
        <var name="SHELL" value="/bin/bash"/>
        <var name="GNOME_KEYRING_PID" value="2137"/>
        <var name="GTK_RC_FILES" value="/etc/gtk/gtkrc:/home/jeremiah/.gtkrc-1.2-gnome2"/>
        <var name="DESKTOP_SESSION" value="gnome"/>
        <var name="QTINC" value="/usr/lib64/qt-3.3/include"/>
        <var name="DISPLAY" value=":0.0"/>
        <var name="USER" value="jeremiah"/>
        <var name="HOME" value="/home/jeremiah"/>
        <var name="HISTCONTROL" value="ignoredups"/>
        <var name="LESSOPEN" value="|/usr/bin/lesspipe.sh %s"/>
        <var name="ORBIT_SOCKETDIR" value="/tmp/orbit-jeremiah"/>
        <var name="LANG" value="en_US.utf8"/>
        <var name="java.runtime.name" value="OpenJDK Runtime Environment"/>
        <var name="sun.boot.library.path"
            value="/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/amd64"/>
        <var name="java.vm.version" value="20.0-b12"/>
        <var name="java.util.prefs.syncInterval" value="2000000"/>
        <var name="java.vm.vendor" value="Sun Microsystems Inc."/>
        <var name="java.vendor.url" value="http://java.sun.com/"/>
        <var name="path.separator" value=":"/>
        <var name="java.vm.name" value="OpenJDK 64-Bit Server VM"/>
        <var name="file.encoding.pkg" value="sun.io"/>
        <var name="sun.java.launcher" value="SUN_STANDARD"/>
        <var name="user.country" value="US"/>
        <var name="sun.os.patch.level" value="unknown"/>
        <var name="java.vm.specification.name" value="Java Virtual Machine Specification"/>
        <var name="user.dir" value="/home/jeremiah/java-work/delcyon-capo"/>
        <var name="java.runtime.version" value="1.6.0_24-b24"/>
        <var name="java.awt.graphicsenv" value="sun.awt.X11GraphicsEnvironment"/>
        <var name="java.endorsed.dirs"
            value="/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/endorsed"/>
        <var name="os.arch" value="amd64"/>
        <var name="java.io.tmpdir" value="/tmp"/>
        <var name="line.separator" value="&#xA;"/>
        <var name="java.vm.specification.vendor" value="Sun Microsystems Inc."/>
        <var name="os.name" value="Linux"/>
        <var name="javax.net.ssl.keyStorePassword" value="password"/>
        <var name="sun.jnu.encoding" value="UTF-8"/>
        <var name="java.library.path"
            value="/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/amd64/server:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/amd64:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/../lib/amd64:/usr/lib/mozilla-1.7.6:/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib"/>
        <var name="java.specification.name" value="Java Platform API Specification"/>
        <var name="java.class.version" value="50.0"/>
        <var name="sun.management.compiler" value="HotSpot 64-Bit Tiered Compilers"/>
        <var name="os.version" value="2.6.32-220.7.1.el6.x86_64"/>
        <var name="javax.xml.xpath.XPathFactory" value="net.sf.saxon.xpath.XPathFactoryImpl"/>
        <var name="user.home" value="/home/jeremiah"/>
        <var name="user.timezone" value="America/Chicago"/>
        <var name="java.awt.printerjob" value="sun.print.PSPrinterJob"/>
        <var name="javax.xml.transform.TransformerFactory"
            value="net.sf.saxon.TransformerFactoryImpl"/>
        <var name="file.encoding" value="UTF-8"/>
        <var name="java.specification.version" value="1.6"/>
        <var name="java.class.path"
            value="/home/jeremiah/java-work/delcyon-capo/build:/home/jeremiah/java-work/delcyon-capo/lib/commons-cli-1.2.jar:/home/jeremiah/java-work/delcyon-capo/lib/scannotation-1.0.2.jar:/home/jeremiah/java-work/delcyon-capo/lib/javassist-3.8.0.GA.jar:/home/jeremiah/java-work/delcyon-capo/lib/saxon.jar:/home/jeremiah/java-work/delcyon-capo/lib-other/postgresql-8.3-604.jdbc3.jar:/home/jeremiah/java-work/delcyon-capo/lib/bcprov-jdk16-146.jar:/home/jeremiah/java-work/delcyon-capo/lib/bcmail-jdk16-146.jar:/home/jeremiah/java-work/delcyon-capo/lib/wrapper.jar:/home/jeremiah/java-work/delcyon-capo/lib-other/hsqldb.jar:/opt/eclipse/plugins/org.junit_4.10.0.v4_10_0_v20120426-0900/junit.jar:/opt/eclipse/plugins/org.hamcrest.core_1.1.0.v20090501071000.jar:/opt/eclipse/configuration/org.eclipse.osgi/bundles/344/2/.cp/:/opt/eclipse/configuration/org.eclipse.osgi/bundles/343/2/.cp/"/>
        <var name="user.name" value="jeremiah"/>
        <var name="java.vm.specification.version" value="1.0"/>
        <var name="sun.java.command"
            value="org.eclipse.jdt.internal.junit.runner.RemoteTestRunner -version 3 -port 51788 -testLoaderClass org.eclipse.jdt.internal.junit4.runner.JUnit4TestLoader -loaderpluginname org.eclipse.jdt.junit4.runtime -test com.delcyon.capo.crypto.CertificateRequestProcessorTest:testServerEmptyClientEmpty"/>
        <var name="java.home" value="/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre"/>
        <var name="sun.arch.data.model" value="64"/>
        <var name="user.language" value="en"/>
        <var name="java.specification.vendor" value="Sun Microsystems Inc."/>
        <var name="java.vm.info" value="mixed mode"/>
        <var name="java.version" value="1.6.0_24"/>
        <var name="java.ext.dirs"
            value="/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/ext:/usr/java/packages/lib/ext"/>
        <var name="sun.boot.class.path"
            value="/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/resources.jar:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/rt.jar:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/jsse.jar:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/jce.jar:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/charsets.jar:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/jre/lib/rhino.jar:/usr/lib/jvm/java-1.6.0-openjdk-1.6.0.0.x86_64/lib/tools.jar"/>
        <var name="javax.xml.parsers.DocumentBuilderFactory"
            value="com.delcyon.capo.xml.cdom.CDocumentBuilderFactory"/>
        <var name="java.vendor" value="Sun Microsystems Inc."/>
        <var name="file.separator" value="/"/>
        <var name="java.vendor.url.bug" value="http://java.sun.com/cgi-bin/bugreport.cgi"/>
        <var name="sun.io.unicode.encoding" value="UnicodeLittle"/>
        <var name="sun.cpu.endian" value="little"/>
        <var name="sun.desktop" value="gnome"/>
        <var name="sun.cpu.isalist" value=""/>
    </ControllerRequest>
    <server:group name="default">
        <server:log message="OS NAME = Linux"/>
        <server:choose>
            <server:when test="//var[@name = 'os.name' and @value = 'Linux']">
                <server:call ref="server:group('linux_group')"/>
            </server:when>
            <server:when test="//var[@name = 'os.name' and matches(@value,'.*win.*','i')]">
                <server:call ref="server:group('windows_group')"/>
            </server:when>
            <server:when test=".[matches('${os.name}','Mac OS X','i')]">
                <server:call ref="server:group('osx_group')"/>
            </server:when>
            <server:otherwise>
                <server:call ref="server:group('other_group')"/>
            </server:otherwise>
        </server:choose>
    </server:group>
    <server:group name="osx_group" returns="MAC,hostname">
        <server:log message="Processing OSX Group" output="STDOUT"/>
        <client:command exec="/sbin/ifconfig" name="osx_ifconfig"/>
        <server:transform name="osx_ifconfig_transform" ref="${osx_ifconfig}"
            stylesheet="osx_ifconfig_command_stdout_parser.xsl"/>
        <server:var eval="${osx_ifconfig_transform}/link[@dev = 'en0']/@ether" name="localMAC"/>
        <client:command exec="/bin/hostname" name="hostname.cmd"/>
        <server:var eval="${hostname.cmd}/stdout" name="localHostname"/>
        <server:setID name="MAC" value="${localMAC}"/>
        <server:setID name="hostname" value="${localHostname}"/>
    </server:group>
    <server:group name="linux_group" returns="MAC,hostname">
        <server:log message="Processing Linux Group" output="STDOUT"/>
        <client:command exec="/sbin/ip link show eth0" name="linux_eth0_link" exitCode="0">
            <stdout>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
                link/ether cc:52:af:3e:61:6a brd ff:ff:ff:ff:ff:ff</stdout>
            <stderr/>
        </client:command>
        <client:command exec="/bin/hostname" name="hostname.cmd" exitCode="0">
            <stdout>bluejay.goodinassociates.com</stdout>
            <stderr/>
        </client:command>
        <server:var eval="/client:request[1]/ControllerRequest[1]/client:command[@name = 'hostname.cmd']/stdout"
            name="localHostname"/>
        <server:var eval="replace(${linux_eth0_link}/stdout,'.*ether (.*) brd.*','$1','ms')"
            name="localMAC"/>
        <server:setID name="MAC" value="${localMAC}"/>
        <server:setID name="hostname" value="${localHostname}"/>
    </server:group>
</server:Capo>